<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRS Flashcard App</title>
    <!-- Caricamento di Tailwind CSS per uno styling rapido e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Caricamento di Marked.js per il rendering del Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Stili Personalizzati */
        :root {
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --danger-color: #ef4444;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .card-content {
            min-height: 150px;
            text-align: left;
            padding: 1.5rem;
            background: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        /* Stile per il contenuto Markdown */
        .card-content h1, .card-content h2 { font-size: 1.5em; margin-bottom: 0.5em; font-weight: 700; }
        .card-content p { margin-bottom: 1em; line-height: 1.6; }
        .card-content img { max-width: 100%; height: auto; border-radius: 0.5rem; margin: 1em 0; }
        .card-content ul { list-style: disc; margin-left: 1.5em; padding-left: 0; }
        .card-content strong { font-weight: 600; }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Contenitore Principale -->
    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-6 md:p-10">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">SRS Flashcard Manager</h1>
        
        <!-- Navigazione (Menu) -->
        <nav class="flex justify-center space-x-4 mb-8">
            <button onclick="showView('review')" id="nav-review" class="px-4 py-2 text-sm font-medium rounded-lg transition duration-150 hover:bg-blue-100 bg-blue-500 text-white">Ripasso Giornaliero</button>
            <button onclick="showView('create')" id="nav-create" class="px-4 py-2 text-sm font-medium rounded-lg transition duration-150 hover:bg-gray-200 text-gray-700">Crea Nuova Carta</button>
            <button onclick="showView('stats')" id="nav-stats" class="px-4 py-2 text-sm font-medium rounded-lg transition duration-150 hover:bg-gray-200 text-gray-700">Riepilogo & Statistiche</button>
        </nav>

        <!-- Area Contenuto Dinamico -->
        <div id="app-content">
        </div>
    </div>

    <!-- Script JavaScript -->
    <script>
        // CONFIGURAZIONE GLOBALE E MODELLO DATI
        const DB_NAME = 'SRS_Flashcard_DB';
        const DB_VERSION = 1;
        const STORE_NAME = 'flashcards';
        const STATS_STORE_NAME = 'stats';
        
        // A. Dati Globali (Constants)
        const INTERVALS = [1, 3, 7, 16, 35];

        // Le funzionalit√† AI sono state rimosse per semplificare il deployment e l'architettura.

        let db;
        let allCards = [];
        let dueCards = [];
        let currentCardIndex = 0;
        let currentView = 'review';
        let stats = { totalOk: 0, totalKo: 0, totalCards: 0, topicStats: {} };

        // --- UTILITY PER DATE E LOGICA SRS ---

        /** Calcola il timestamp di mezzanotte UTC per una data (usato per l'indicizzazione) */
        function getMidnightTimestamp(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            return d.getTime();
        }

        /** Aggiunge giorni a una data */
        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }

        /**
         * 3. LOGICA ALGORITMICA (IL MOTORE SRS)
         * Calcola il prossimo livello e la prossima data di ripasso.
         */
        function calculateNextReview(card, isCorrect) {
            let newLevel = card.livelloDiRipetizione;

            if (isCorrect) {
                // A. Risposta Corretta (Promozione)
                newLevel = Math.min(newLevel + 1, INTERVALS.length);
            } else {
                // B. Risposta Sbagliata (Punizione)
                newLevel = Math.max(1, newLevel - 1);
            }

            const daysToWait = INTERVALS[newLevel - 1];
            const today = new Date();
            const nextReviewDate = getMidnightTimestamp(addDays(today, daysToWait));

            return {
                livelloDiRipetizione: newLevel,
                dataDiProssimoRipasso: nextReviewDate
            };
        }


        // --- LOGICA INDEXEDDB ---

        /** Inizializza il database IndexedDB */
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = (event) => {
                    console.error("Errore nell'apertura di IndexedDB:", event.target.error);
                    reject("Errore DB");
                };

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    // Crea l'Object Store 'flashcards'
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const store = db.createObjectStore(STORE_NAME, { keyPath: 'id' });
                        // Crea gli indici richiesti
                        store.createIndex('dataDiProssimoRipasso', 'dataDiProssimoRipasso', { unique: false });
                        store.createIndex('argomento', 'argomento', { unique: false });
                    }
                    // Crea l'Object Store 'stats' per le metriche aggregate
                    if (!db.objectStoreNames.contains(STATS_STORE_NAME)) {
                        db.createObjectStore(STATS_STORE_NAME, { keyPath: 'id' });
                    }
                };

                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log("IndexedDB aperto con successo.");
                    resolve(db);
                };
            });
        }

        /** Esegue una transazione di lettura/scrittura */
        function transact(storeName, mode) {
            const transaction = db.transaction(storeName, mode);
            return transaction.objectStore(storeName);
        }

        /** Salva o aggiorna una singola carta */
        function saveCard(card) {
            return new Promise((resolve, reject) => {
                const store = transact(STORE_NAME, 'readwrite');
                const request = store.put(card);

                request.onsuccess = () => resolve(card);
                request.onerror = (event) => reject(event.target.error);
            });
        }

        /** Carica le statistiche globali */
        function loadStats() {
            return new Promise((resolve) => {
                const store = transact(STATS_STORE_NAME, 'readonly');
                const request = store.get('global_stats');
                
                request.onsuccess = (event) => {
                    stats = {
                        totalOk: 0,
                        totalKo: 0,
                        totalCards: allCards.length,
                        topicStats: {},
                        ...(event.target.result || {})
                    };
                    stats.totalCards = allCards.length;
                    resolve(stats);
                };
                request.onerror = () => {
                    console.warn("Impossibile caricare le statistiche. Usando i valori predefiniti.");
                    resolve(stats);
                };
            });
        }

        /** Salva le statistiche globali */
        function saveStats() {
            stats.id = 'global_stats';
            return new Promise((resolve, reject) => {
                const store = transact(STATS_STORE_NAME, 'readwrite');
                const request = store.put(stats);

                request.onsuccess = () => resolve();
                request.onerror = (event) => reject(event.target.error);
            });
        }

        /** Carica TUTTE le carte e filtra quelle da ripassare */
        async function loadCards() {
            return new Promise((resolve, reject) => {
                const store = transact(STORE_NAME, 'readonly');
                const request = store.getAll();

                request.onsuccess = (event) => {
                    allCards = event.target.result || [];
                    
                    const today = getMidnightTimestamp(new Date());

                    // Filtra le carte la cui data di ripasso √® oggi o passata.
                    dueCards = allCards
                        .filter(card => card.dataDiProssimoRipasso <= today)
                        .sort((a, b) => a.dataDiProssimoRipasso - b.dataDiProssimoRipasso);

                    stats.totalCards = allCards.length;
                    
                    console.log(`Carte totali: ${allCards.length}, Carte da ripassare oggi: ${dueCards.length}`);
                    resolve();
                };

                request.onerror = (event) => {
                    console.error("Errore nel caricamento delle carte:", event.target.error);
                    reject("Errore nel caricamento delle carte.");
                };
            });
        }

        // --- GESTIONE VISTE E FLUSSO APPLICAZIONE ---

        /** Gestisce il cambio di vista */
        function showView(viewName) {
            currentView = viewName;
            const contentDiv = document.getElementById('app-content');
            
            document.querySelectorAll('nav button').forEach(btn => {
                if (btn.id === `nav-${viewName}`) {
                    btn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                    btn.classList.add('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                } else {
                    btn.classList.remove('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                    btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                }
            });

            contentDiv.innerHTML = '<div class="flex justify-center items-center h-48"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div></div>';

            switch (viewName) {
                case 'review':
                    loadCards().then(renderReviewView);
                    break;
                case 'create':
                    renderCreateView();
                    break;
                case 'stats':
                    loadCards().then(loadStats).then(renderStatsView);
                    break;
                default:
                    renderReviewView();
            }
        }

        // --- 4. INTERFACCIA UTENTE (UI) ---

        // A. Schermata di Ripasso Giornaliero
        let isAnswerVisible = false;

        function renderReviewView() {
            const contentDiv = document.getElementById('app-content');
            
            if (dueCards.length === 0) {
                contentDiv.innerHTML = `
                    <div class="text-center p-8 bg-green-50 rounded-lg border border-green-200">
                        <svg class="mx-auto h-12 w-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h2 class="text-xl font-semibold text-green-800 mt-3">Complimenti!</h2>
                        <p class="text-green-700 mt-1">Non hai carte da ripassare per oggi. Torna domani!</p>
                        <p class="text-sm text-green-600 mt-4">Totale carte in archivio: ${allCards.length}</p>
                    </div>
                `;
                return;
            }

            const card = dueCards[currentCardIndex];
            isAnswerVisible = false;

            const nextCardButtonHtml = (currentCardIndex < dueCards.length - 1) ? 
                `<p class="text-sm text-gray-500 mt-4">Prossima carta: ${currentCardIndex + 2} di ${dueCards.length}</p>` :
                `<p class="text-sm text-gray-500 mt-4">Questa √® l'ultima carta del giorno!</p>`;

            contentDiv.innerHTML = `
                <div class="text-center mb-6">
                    <p class="text-lg font-medium text-gray-600">Carta ${currentCardIndex + 1} di ${dueCards.length} in ripasso.</p>
                    <p class="text-sm text-gray-400">Argomento: <span class="font-semibold text-gray-600">${card.argomento}</span></p>
                </div>

                <!-- Contenitore della Carta -->
                <div class="bg-white rounded-xl shadow-lg border-2 border-blue-400 p-6">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-2xl font-bold text-blue-700">Domanda:</h2>
                        <span class="px-3 py-1 bg-blue-100 text-blue-600 text-xs font-semibold rounded-full">Livello ${card.livelloDiRipetizione}</span>
                    </div>
                    
                    <!-- Contenuto Domanda (Markdown) -->
                    <div id="card-question-content" class="card-content">
                        ${marked.parse(card.domanda)}
                    </div>
                    
                    <button id="show-answer-btn" onclick="showAnswer()" class="w-full mt-6 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition duration-150">
                        Mostra Risposta
                    </button>
                    
                    <!-- Contenuto Risposta (Nascosto inizialmente) -->
                    <div id="card-answer-container" class="mt-6 border-t pt-6 hidden">
                        <h2 class="text-2xl font-bold text-green-700 mb-4">Risposta:</h2>
                        <div id="card-answer-content" class="card-content border-green-200">
                        </div>

                        <!-- Pulsanti Valutazione -->
                        <div class="flex justify-center space-x-4 mt-8">
                            <button onclick="handleReview(false)" class="flex items-center px-6 py-3 bg-red-500 text-white font-bold rounded-xl shadow-lg hover:bg-red-600 transition duration-150 transform hover:scale-105">
                                <span class="text-xl mr-2">‚ùå</span> KO (Sbagliata)
                            </button>
                            <button onclick="handleReview(true)" class="flex items-center px-6 py-3 bg-green-500 text-white font-bold rounded-xl shadow-lg hover:bg-green-600 transition duration-150 transform hover:scale-105">
                                <span class="text-xl mr-2">üëç</span> OK (Corretta)
                            </button>
                        </div>
                    </div>
                </div>
                ${nextCardButtonHtml}
            `;
        }


        /** Mostra la risposta e i pulsanti di valutazione */
        function showAnswer() {
            if (isAnswerVisible) return;
            isAnswerVisible = true;
            const card = dueCards[currentCardIndex];
            
            document.getElementById('show-answer-btn').classList.add('hidden');
            document.getElementById('card-answer-container').classList.remove('hidden');
            document.getElementById('card-answer-content').innerHTML = marked.parse(card.risposta);
        }

        /** Gestisce la valutazione (OK/KO) e aggiorna la carta nel DB */
        async function handleReview(isCorrect) {
            const card = dueCards[currentCardIndex];
            
            const srsResult = calculateNextReview(card, isCorrect);
            
            card.livelloDiRipetizione = srsResult.livelloDiRipetizione;
            card.dataDiProssimoRipasso = srsResult.dataDiProssimoRipasso;

            if (isCorrect) {
                stats.totalOk++;
            } else {
                stats.totalKo++;
            }
            if (!stats.topicStats[card.argomento]) {
                stats.topicStats[card.argomento] = { ok: 0, ko: 0 };
            }
            if (isCorrect) {
                stats.topicStats[card.argomento].ok++;
            } else {
                stats.topicStats[card.argomento].ko++;
            }

            try {
                await saveCard(card);
                await saveStats();
                
                currentCardIndex++;
                if (currentCardIndex < dueCards.length) {
                    renderReviewView();
                } else {
                    currentCardIndex = 0;
                    showView('review');
                }

            } catch (e) {
                console.error("Errore nell'aggiornamento della carta:", e);
                alertMessage("Errore critico: impossibile salvare l'aggiornamento della carta nel DB.", 'danger', 'message-container-review');
            }
        }

        // B. Schermata di Creazione Carte
        function renderCreateView() {
            const contentDiv = document.getElementById('app-content');
            
            contentDiv.innerHTML = `
                <div class="max-w-xl mx-auto p-6 bg-gray-50 rounded-xl shadow-inner">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">Nuova Flashcard</h2>
                    <form id="create-card-form" onsubmit="event.preventDefault(); handleCreateCard(event);">
                        
                        <div class="mb-4">
                            <label for="argomento" class="block text-sm font-medium text-gray-700 mb-1">Argomento (Categorizzazione)</label>
                            <input type="text" id="argomento" name="argomento" required class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div class="mb-4">
                            <label for="domanda" class="block text-sm font-medium text-gray-700 mb-1">Domanda (Markdown supportato)</label>
                            <textarea id="domanda" name="domanda" rows="4" required class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                            <button type="button" onclick="previewMarkdown('domanda', 'preview-domanda')" class="mt-1 text-xs text-blue-600 hover:text-blue-800">Anteprima Domanda</button>
                            <div id="preview-domanda" class="mt-2 p-3 bg-white border border-dashed border-gray-300 rounded-lg hidden card-content"></div>
                        </div>

                        <div class="mb-6">
                            <label for="risposta" class="block text-sm font-medium text-gray-700 mb-1">Risposta (Markdown supportato)</label>
                            <textarea id="risposta" name="risposta" rows="6" required class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                            <button type="button" onclick="previewMarkdown('risposta', 'preview-risposta')" class="mt-1 text-xs text-blue-600 hover:text-blue-800">Anteprima Risposta</button>
                            <div id="preview-risposta" class="mt-2 p-3 bg-white border border-dashed border-gray-300 rounded-lg hidden card-content"></div>
                        </div>
                        
                        <button type="submit" class="w-full py-3 bg-green-500 text-white font-bold rounded-xl shadow-lg hover:bg-green-600 transition duration-150">
                            Salva Nuova Carta
                        </button>

                        <div id="message-container" class="mt-4"></div>
                    </form>
                </div>
            `;
        }
        
        /** Visualizza l'anteprima del Markdown */
        function previewMarkdown(inputId, previewId) {
            const input = document.getElementById(inputId).value;
            const preview = document.getElementById(previewId);
            
            if (input.trim() === '') {
                preview.classList.add('hidden');
                return;
            }
            
            preview.innerHTML = marked.parse(input); 
            preview.classList.remove('hidden');
        }

        /** Gestisce l'invio del modulo di creazione carta */
        async function handleCreateCard(event) {
            const form = event.target;
            const data = new FormData(form);

            const today = new Date();
            const tomorrow = getMidnightTimestamp(addDays(today, INTERVALS[0])); 

            // 2. MODELLO DATI - Struttura dell'Oggetto Carta & Inizializzazione
            const newCard = {
                id: Date.now(),
                domanda: data.get('domanda').trim(),
                risposta: data.get('risposta').trim(),
                argomento: data.get('argomento').trim() || 'Generale',
                livelloDiRipetizione: 1,
                dataDiProssimoRipasso: tomorrow
            };

            try {
                await saveCard(newCard);
                form.reset();
                const previewDomanda = document.getElementById('preview-domanda');
                const previewRisposta = document.getElementById('preview-risposta');
                if (previewDomanda) previewDomanda.classList.add('hidden');
                if (previewRisposta) previewRisposta.classList.add('hidden');
                
                alertMessage("Carta creata con successo! Prossimo ripasso: Domani.", 'success');
            } catch (e) {
                console.error("Errore nel salvataggio della carta:", e);
                alertMessage("Errore: impossibile salvare la carta nel database.", 'danger');
            }
        }

        // C. Schermata di Riepilogo e Statistiche
        function renderStatsView() {
            const contentDiv = document.getElementById('app-content');
            const totalAttempts = stats.totalOk + stats.totalKo;
            const successRate = totalAttempts > 0 ? ((stats.totalOk / totalAttempts) * 100).toFixed(1) : '0.0';
            const dueToday = dueCards.length;
            
            let topicRows = '';
            for (const [topic, topicStats] of Object.entries(stats.topicStats)) {
                const topicAttempts = topicStats.ok + topicStats.ko;
                const topicRate = topicAttempts > 0 ? ((topicStats.ok / topicAttempts) * 100).toFixed(1) : '0.0';
                
                topicRows += `
                    <tr>
                        <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${topic}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">${topicStats.ok}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">${topicStats.ko}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm font-bold ${parseFloat(topicRate) > 70 ? 'text-green-600' : 'text-orange-600'}">${topicRate}%</td>
                    </tr>
                `;
            }

            contentDiv.innerHTML = `
                <div class="p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">Riepilogo e Statistiche Globali</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <!-- Stat Box 1: Carte Totali -->
                        <div class="bg-blue-50 p-6 rounded-xl shadow-md border-b-4 border-blue-500 text-center">
                            <p class="text-5xl font-extrabold text-blue-700">${stats.totalCards}</p>
                            <p class="text-gray-600 mt-2">Totale Carte Archiviate</p>
                        </div>
                        
                        <!-- Stat Box 2: Carte Dovute Oggi -->
                        <div class="bg-red-50 p-6 rounded-xl shadow-md border-b-4 border-red-500 text-center">
                            <p class="text-5xl font-extrabold text-red-700">${dueToday}</p>
                            <p class="text-gray-600 mt-2">Carte da Ripassare Oggi</p>
                        </div>
                        
                        <!-- Stat Box 3: Percentuale di Successo -->
                        <div class="bg-green-50 p-6 rounded-xl shadow-md border-b-4 border-green-500 text-center">
                            <p class="text-5xl font-extrabold text-green-700">${successRate}%</p>
                            <p class="text-gray-600 mt-2">Percentuale di Successo (OK)</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold text-gray-800 mb-4 mt-8">Metriche per Argomento</h3>
                    <div class="overflow-x-auto shadow ring-1 ring-black ring-opacity-5 md:rounded-lg">
                        <table class="min-w-full divide-y divide-gray-300">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Argomento</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Totale OK</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Totale KO</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tasso di Successo</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 bg-white">
                                ${topicRows || '<tr><td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">Nessuna statistica disponibile per argomento.</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                    
                    <p class="text-sm text-gray-500 mt-6 text-center">Ultimo aggiornamento: ${new Date().toLocaleDateString('it-IT')}</p>
                </div>
            `;
        }

        // --- MESSAGGISTICA UI (Sostituto di alert()) ---

        /** Mostra un messaggio di notifica (successo/errore) */
        function alertMessage(message, type) {
            const container = document.getElementById('message-container') || document.getElementById('app-content');
            let bgColor, borderColor, textColor;

            switch(type) {
                case 'success':
                    bgColor = 'bg-green-100';
                    borderColor = 'border-green-400';
                    textColor = 'text-green-700';
                    break;
                case 'danger':
                    bgColor = 'bg-red-100';
                    borderColor = 'border-red-400';
                    textColor = 'text-red-700';
                    break;
                default:
                    bgColor = 'bg-blue-100';
                    borderColor = 'border-blue-400';
                    textColor = 'text-blue-700';
            }

            const alertHtml = `
                <div id="temp-alert" class="${bgColor} ${borderColor} ${textColor} border-l-4 p-4 rounded-lg shadow-md mb-4" role="alert">
                    <p class="font-bold">${type === 'success' ? 'Successo' : 'Attenzione'}</p>
                    <p>${message}</p>
                </div>
            `;
            
            const targetContainer = document.getElementById('message-container') || document.getElementById('app-content');
            targetContainer.insertAdjacentHTML('afterbegin', alertHtml);
            const alertElement = document.getElementById('temp-alert');
            
            setTimeout(() => {
                if (alertElement) {
                    alertElement.remove();
                }
            }, 5000);
        }

        // --- INIZIALIZZAZIONE ---

        window.onload = async () => {
            try {
                await initDB();
                await loadCards();
                await loadStats();
                showView('review');
            } catch (e) {
                document.getElementById('app-content').innerHTML = `
                    <div class="text-center p-8 bg-red-100 rounded-lg border border-red-400 text-red-700">
                        <p class="font-bold">Errore di Inizializzazione Critico</p>
                        <p>Impossibile accedere a IndexedDB. L'applicazione non pu√≤ funzionare senza la persistenza dei dati.</p>
                        <p class="text-sm mt-2">${e}</p>
                    </div>
                `;
                console.error("Errore all'avvio dell'applicazione:", e);
            }
        };

        /** Rende le funzioni globalmente accessibili per gli attributi onclick nell'HTML */
        window.showView = showView;
        window.showAnswer = showAnswer;
        window.handleReview = handleReview;
        window.handleCreateCard = handleCreateCard;
        window.previewMarkdown = previewMarkdown;
    </script>
</body>
</html>
